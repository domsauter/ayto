import{r as g,j as e}from"./auth-CiqFla1T.js";import{u as k}from"./season-B2oCyVg0.js";import{s as C,a as M}from"./solver-BmGmwYWn.js";function A(){const{currentSeason:o}=k(),[x,f]=g.useState(null),[u,w]=g.useState(null),[y,v]=g.useState(null),[N,j]=g.useState(!1),{men:P,women:$}=g.useMemo(()=>o?{men:o.candidates.filter(s=>s.gender==="Mann"),women:o.candidates.filter(s=>s.gender==="Frau")}:{men:[],women:[]},[o]),E=g.useCallback(()=>{o&&(j(!0),setTimeout(()=>{try{console.log("Starting solver with season:",o);const s=C(o);console.log("Solver completed. Found",s.length,"solutions"),v(s.length);const i=M(o,s);w(i),console.log("Partner analysis completed:",i);const c=o.truthBooths||[],n=c.filter(t=>t.is_perfect_match),a=new Set(c.filter(t=>!t.is_perfect_match).map(t=>`${Number(t.couple.man)}-${Number(t.couple.woman)}`));if(s.length>0){const t={},m=s.length,b=new Set;o.matchingNights.forEach(r=>{r.couples.forEach(l=>{const d=`${Number(l.mann)}-${Number(l.frau)}`;a.has(d)||b.add(d)})}),o.truthBooths.forEach(r=>{const l=Number(r.couple.man),d=Number(r.couple.woman),h=`${l}-${d}`;a.has(h)||b.add(h)}),b.forEach(r=>{t[r]=0}),s.forEach(r=>{b.forEach(l=>{const[d,h]=l.split("-").map(Number);r[d]===h&&t[l]++})});const p=Object.entries(t).map(([r,l])=>{const[d,h]=r.split("-").map(Number);return{manId:d,womanId:h,probability:l/m*100}});n.forEach(r=>{const l=Number(r.couple.man),d=Number(r.couple.woman),h=`${l}-${d}`,I=p.find(S=>S.manId===l&&S.womanId===d);I?I.probability=100:p.push({manId:l,womanId:d,probability:100})}),p.sort((r,l)=>l.probability-r.probability),f(p)}else{const t=n.map(m=>({manId:Number(m.couple.man),womanId:Number(m.couple.woman),probability:100}));f(t)}j(!1)}catch(s){console.error("Error during solve:",s),alert("Fehler beim Berechnen: "+s.message),v(null),w(null),f(null),j(!1)}},0))},[o]);return e.jsxs("div",{className:"p-8",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-4",children:["Predictions for ",o.name]}),e.jsx("button",{onClick:E,disabled:N,className:`px-4 py-2 rounded-md mb-8 ${N?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"} text-white`,children:N?"Berechne...":"Mögliche Matches berechnen"}),y!==null&&e.jsxs("h2",{className:"text-xl font-bold mb-2",children:[y," mögliche Lösung(en) gefunden"]}),u&&u.contradictions.length>0&&e.jsxs("div",{className:"mb-6 p-4 bg-red-100 border-l-4 border-red-500 rounded",children:[e.jsx("h3",{className:"text-lg font-bold text-red-800 mb-3",children:"⚠️ Widersprüche gefunden!"}),u.contradictions.map((s,i)=>e.jsx("div",{className:"text-red-700 mb-2",children:s.message},i))]}),u&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-bold mb-6 text-blue-900",children:"Perfect Match Kandidaten"}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"font-bold mb-4 text-blue-800",children:"Männer"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:P.map(s=>{const i=u.men[s.id],c=x?x.filter(n=>n.manId===s.id).sort((n,a)=>a.probability-n.probability):[];return e.jsxs("div",{className:`p-4 rounded-lg ${i.possiblePartners.length===0?"bg-red-100 border-l-4 border-red-500":i.certainPartner?"bg-green-100 border-l-4 border-green-500":"bg-white border border-blue-200"}`,children:[e.jsx("p",{className:"font-bold text-lg mb-3",children:s.name}),i.possiblePartners.length===0?e.jsx("p",{className:"text-red-700",children:"❌ Kein Partner möglich"}):c.length>0?e.jsx("div",{className:"space-y-2",children:c.map(({womanId:n,probability:a},t)=>{const m=$.find(b=>b.id===n);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm",children:[e.jsxs("span",{className:"font-semibold",children:[t+1,"."]})," ",m?.name]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${a===100?"bg-green-500":"bg-blue-500"}`,style:{width:`${a}%`}})}),e.jsxs("span",{className:"text-sm font-semibold w-10 text-right",children:[a.toFixed(1),"%"]})]})]},`${s.id}-${n}`)})}):e.jsx("p",{className:"text-sm text-gray-500",children:"Keine Daten"})]},s.id)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold mb-4 text-pink-800",children:"Frauen"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:$.map(s=>{const i=u.women[s.id],c=x?x.filter(n=>n.womanId===s.id).sort((n,a)=>a.probability-n.probability):[];return e.jsxs("div",{className:`p-4 rounded-lg ${i.possiblePartners.length===0?"bg-red-100 border-l-4 border-red-500":i.certainPartner?"bg-green-100 border-l-4 border-green-500":"bg-white border border-pink-200"}`,children:[e.jsx("p",{className:"font-bold text-lg mb-3",children:s.name}),i.possiblePartners.length===0?e.jsx("p",{className:"text-red-700",children:"❌ Kein Partner möglich"}):c.length>0?e.jsx("div",{className:"space-y-2",children:c.map(({manId:n,probability:a},t)=>{const m=P.find(b=>b.id===n);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm",children:[e.jsxs("span",{className:"font-semibold",children:[t+1,"."]})," ",m?.name]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${a===100?"bg-green-500":"bg-pink-500"}`,style:{width:`${a}%`}})}),e.jsxs("span",{className:"text-sm font-semibold w-10 text-right",children:[a.toFixed(1),"%"]})]})]},`${n}-${s.id}`)})}):e.jsx("p",{className:"text-sm text-gray-500",children:"Keine Daten"})]},s.id)})})]})]})]})}export{A as default};
