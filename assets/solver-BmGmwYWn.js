function f(o,s){if(s===0)return[[]];if(o.length===0)return[];if(s===o.length)return[o];const i=o[0],c=o.slice(1),h=f(c,s-1).map(n=>[i,...n]),t=f(c,s);return[...h,...t]}function N(o){try{if(console.log("Solver starting..."),!o.matchingNights||!Array.isArray(o.matchingNights)||o.matchingNights.length===0)return console.log("No matching nights found"),[];const s=o.truthBooths||[],i=new Set;s.forEach(e=>{e.is_perfect_match&&i.add(`${Number(e.couple.man)}-${Number(e.couple.woman)}`)});const c=new Set;s.forEach(e=>{e.is_perfect_match||c.add(`${Number(e.couple.man)}-${Number(e.couple.woman)}`)}),console.log(`Perfect matches: ${[...i]}`),console.log(`No-match pairs: ${[...c]}`);const h=new Set;o.matchingNights.forEach(e=>{e.couples&&Array.isArray(e.couples)&&e.couples.forEach(r=>{const l=`${Number(r.mann)}-${Number(r.frau)}`;c.has(l)||h.add(l)})});let t=[[...i]];return o.matchingNights.forEach((e,r)=>{if(!e.couples||!Array.isArray(e.couples)){console.warn(`Night ${r} has no couples`);return}console.log(`Processing night ${r}: ${e.couples.length} couples, ${e.lights} lights expected`);const l=e.couples.map(a=>`${Number(a.mann)}-${Number(a.frau)}`).filter(a=>!c.has(a)),m=l.filter(a=>i.has(a)).length,u=e.lights-m,d=l.filter(a=>!i.has(a));if(u<0){console.warn(`Night ${r}: more confirmed matches (${m}) than lights (${e.lights}), skipping`);return}const p=f(d,u);console.log(`Night ${r}: ${p.length} valid combinations of ${u} open couples`);const g=[];t.forEach(a=>{p.forEach($=>{const b=[...new Set([...a,...$])];g.push(b)})}),t=g,console.log(`After night ${r}: ${t.length} valid combinations`)}),console.log(`Solver complete: ${t.length} valid combinations`),t.map(e=>{const r={};return e.forEach(l=>{const[m,u]=l.split("-").map(Number);r[m]=u}),r})}catch(s){throw console.error("Error in solve function:",s),s}}function P(o,s){const i=o.candidates.filter(n=>n.gender==="Mann"),c=o.candidates.filter(n=>n.gender==="Frau"),h=new Set;(o.truthBooths||[]).forEach(n=>{n.is_perfect_match||h.add(`${Number(n.couple.man)}-${Number(n.couple.woman)}`)});const t={men:{},women:{},contradictions:[]};if(i.forEach(n=>{t.men[n.id]={id:n.id,name:n.name,possiblePartners:new Set,certainPartner:null}}),c.forEach(n=>{t.women[n.id]={id:n.id,name:n.name,possiblePartners:new Set,certainPartner:null}}),s.forEach(n=>{Object.entries(n).forEach(([e,r])=>{const l=`${e}-${r}`;h.has(l)||(t.men[e]&&t.men[e].possiblePartners.add(r),t.women[r]&&t.women[r].possiblePartners.add(e))})}),s.length===1){const n=s[0];Object.entries(n).forEach(([e,r])=>{t.men[e]&&(t.men[e].certainPartner=r),t.women[r]&&(t.women[r].certainPartner=e)})}return i.forEach(n=>{const e=Array.from(t.men[n.id].possiblePartners);t.men[n.id].possiblePartners=e,e.length===0&&t.contradictions.push({type:"no_partner",person:n,gender:"Mann",message:`${n.name} hat keinen möglichen Partner - es gibt einen Widerspruch in den Daten!`})}),c.forEach(n=>{const e=Array.from(t.women[n.id].possiblePartners);t.women[n.id].possiblePartners=e,e.length===0&&t.contradictions.push({type:"no_partner",person:n,gender:"Frau",message:`${n.name} hat keinen möglichen Partner - es gibt einen Widerspruch in den Daten!`})}),t}export{P as a,N as s};
