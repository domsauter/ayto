import{r as g,j as e}from"./auth-CiqFla1T.js";import{u as F}from"./season-B2oCyVg0.js";import{s as K,a as B}from"./solver-BhoZawJP.js";function W(){const{currentSeason:o}=F(),[p,x]=g.useState(null),[h,w]=g.useState(null),[y,v]=g.useState(null),[f,N]=g.useState(!1),{men:$,women:P}=g.useMemo(()=>o?{men:o.candidates.filter(s=>s.gender==="Mann"),women:o.candidates.filter(s=>s.gender==="Frau")}:{men:[],women:[]},[o]),E=g.useCallback(()=>{o&&(N(!0),setTimeout(()=>{try{console.log("Starting solver with season:",o);const s=K(o);console.log("Solver completed. Found",s.length,"solutions"),v(s.length);const i=B(o,s);w(i),console.log("Partner analysis completed:",i);const m=o.truthBooths||[],t=m.filter(r=>r.is_perfect_match),a=new Set(m.filter(r=>!r.is_perfect_match).map(r=>`${Number(r.couple.man)}-${Number(r.couple.woman)}`));if(s.length>0){const r={},b=s.length,u=new Set;o.matchingNights.forEach(n=>{n.couples.forEach(l=>{const c=`${Number(l.mann)}-${Number(l.frau)}`;a.has(c)||u.add(c)})}),o.truthBooths.forEach(n=>{const l=Number(n.couple.man),c=Number(n.couple.woman),d=`${l}-${c}`;a.has(d)||u.add(d)}),u.forEach(n=>{r[n]=0}),s.forEach(n=>{u.forEach(l=>{const[c,d]=l.split("-").map(Number);n[c]===d&&r[l]++})});const j=Object.entries(r).map(([n,l])=>{const[c,d]=n.split("-").map(Number);return{manId:c,womanId:d,probability:l/b*100}}),M=new Set(t.map(n=>Number(n.couple.man))),C=new Set(t.map(n=>Number(n.couple.woman))),k=new Set(t.map(n=>`${Number(n.couple.man)}-${Number(n.couple.woman)}`));t.forEach(n=>{const l=Number(n.couple.man),c=Number(n.couple.woman),d=j.find(S=>S.manId===l&&S.womanId===c);d?d.probability=100:j.push({manId:l,womanId:c,probability:100})});const I=j.filter(n=>M.has(n.manId)||C.has(n.womanId)?k.has(`${n.manId}-${n.womanId}`):!0);I.sort((n,l)=>l.probability-n.probability),x(I)}else{const r=t.map(b=>({manId:Number(b.couple.man),womanId:Number(b.couple.woman),probability:100}));x(r)}N(!1)}catch(s){console.error("Error during solve:",s),alert("Fehler beim Berechnen: "+s.message),v(null),w(null),x(null),N(!1)}},0))},[o]);return e.jsxs("div",{className:"p-8",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-4",children:["Predictions for ",o.name]}),e.jsx("button",{onClick:E,disabled:f,className:`px-4 py-2 rounded-md mb-8 ${f?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"} text-white`,children:f?"Berechne...":"Mögliche Matches berechnen"}),y!==null&&e.jsxs("h2",{className:"text-xl font-bold mb-2",children:[y," mögliche Lösung(en) gefunden"]}),h&&h.contradictions.length>0&&e.jsxs("div",{className:"mb-6 p-4 bg-red-100 border-l-4 border-red-500 rounded",children:[e.jsx("h3",{className:"text-lg font-bold text-red-800 mb-3",children:"⚠️ Widersprüche gefunden!"}),h.contradictions.map((s,i)=>e.jsx("div",{className:"text-red-700 mb-2",children:s.message},i))]}),h&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-bold mb-6 text-blue-900",children:"Perfect Match Kandidaten"}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"font-bold mb-4 text-blue-800",children:"Männer"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:$.map(s=>{const i=h.men[s.id],m=p?p.filter(t=>t.manId===s.id).sort((t,a)=>a.probability-t.probability):[];return e.jsxs("div",{className:`p-4 rounded-lg ${i.possiblePartners.length===0?"bg-red-100 border-l-4 border-red-500":i.certainPartner?"bg-green-100 border-l-4 border-green-500":"bg-white border border-blue-200"}`,children:[e.jsx("p",{className:"font-bold text-lg mb-3",children:s.name}),i.possiblePartners.length===0?e.jsx("p",{className:"text-red-700",children:"❌ Kein Partner möglich"}):m.length>0?e.jsx("div",{className:"space-y-2",children:m.map(({womanId:t,probability:a},r)=>{const b=P.find(u=>u.id===t);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm",children:[e.jsxs("span",{className:"font-semibold",children:[r+1,"."]})," ",b?.name]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${a===100?"bg-green-500":"bg-blue-500"}`,style:{width:`${a}%`}})}),e.jsxs("span",{className:"text-sm font-semibold w-10 text-right",children:[a.toFixed(1),"%"]})]})]},`${s.id}-${t}`)})}):e.jsx("p",{className:"text-sm text-gray-500",children:"Keine Daten"})]},s.id)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold mb-4 text-pink-800",children:"Frauen"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:P.map(s=>{const i=h.women[s.id],m=p?p.filter(t=>t.womanId===s.id).sort((t,a)=>a.probability-t.probability):[];return e.jsxs("div",{className:`p-4 rounded-lg ${i.possiblePartners.length===0?"bg-red-100 border-l-4 border-red-500":i.certainPartner?"bg-green-100 border-l-4 border-green-500":"bg-white border border-pink-200"}`,children:[e.jsx("p",{className:"font-bold text-lg mb-3",children:s.name}),i.possiblePartners.length===0?e.jsx("p",{className:"text-red-700",children:"❌ Kein Partner möglich"}):m.length>0?e.jsx("div",{className:"space-y-2",children:m.map(({manId:t,probability:a},r)=>{const b=$.find(u=>u.id===t);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm",children:[e.jsxs("span",{className:"font-semibold",children:[r+1,"."]})," ",b?.name]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${a===100?"bg-green-500":"bg-pink-500"}`,style:{width:`${a}%`}})}),e.jsxs("span",{className:"text-sm font-semibold w-10 text-right",children:[a.toFixed(1),"%"]})]})]},`${t}-${s.id}`)})}):e.jsx("p",{className:"text-sm text-gray-500",children:"Keine Daten"})]},s.id)})})]})]})]})}export{W as default};
