import{u as U,r as h,j as e}from"./auth-CiqFla1T.js";import{u as W}from"./season-B2oCyVg0.js";function K(){const{currentSeason:a,addMatchingNight:M,deleteMatchingNight:y,updateMatchingNight:C,loadingCurrentSeason:k,error:N}=W(),{profile:B}=U(),[i,d]=h.useState([]),[S,c]=h.useState(0),[l,m]=h.useState(null),u=B?.role==="admin";if(h.useEffect(()=>{m(null),d([]),c(0)},[a]),!a)return e.jsxs("div",{className:"p-8",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Matching Night"}),e.jsx("p",{children:"Bitte wähle zuerst eine Staffel aus."})]});if(k)return e.jsx("div",{className:"p-8",children:"Loading matching night data..."});if(N)return e.jsxs("div",{className:"p-8 text-red-500",children:["Error: ",N]});const g=a.candidates.filter(n=>n.gender==="Mann"),p=a.candidates.filter(n=>n.gender==="Frau");if(g.length===0||p.length===0)return e.jsxs("div",{className:"p-8",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Matching Night"}),e.jsx("p",{children:"Bitte füge zuerst Kandidaten hinzu (Männer und Frauen)."})]});const o=(a.truthBooths||[]).filter(n=>n.is_perfect_match),P=new Set(o.map(n=>String(n.couple.man))),E=new Set(o.map(n=>String(n.couple.woman))),x=g.filter(n=>!P.has(String(n.id))),f=p.filter(n=>!E.has(String(n.id))),b=Math.min(x.length,f.length),v=(n,s,t)=>{const r=[...i];r[n]||(r[n]={}),r[n][s]=t,d(r)},A=n=>{m(n.id),d(n.couples),c(n.lights)},w=()=>{m(null),d([]),c(0)},I=n=>{if(n.preventDefault(),!u)return;if(i.length<b||i.some(t=>!t||!t.mann||!t.frau)){alert("Please form all pairs.");return}const s={couples:i,lights:S};l?C(a.id,l,s):M(a.id,s),w()},L=i.map(n=>n?.mann).filter(Boolean),z=i.map(n=>n?.frau).filter(Boolean);return e.jsxs("div",{className:"p-8",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-4",children:["Matching Night für ",a.name]}),o.length>0&&e.jsxs("div",{className:"mb-4 p-3 bg-green-50 border border-green-300 rounded-md",children:[e.jsx("p",{className:"font-bold text-green-800 mb-1",children:"✅ Bestätigte Perfect Matches (nicht auswählbar):"}),e.jsx("ul",{className:"text-green-700 text-sm",children:o.map(n=>{const s=g.find(r=>String(r.id)===String(n.couple.man)),t=p.find(r=>String(r.id)===String(n.couple.woman));return e.jsxs("li",{children:[s?.name||"Unbekannt"," & ",t?.name||"Unbekannt"]},n.id)})})]}),u&&e.jsxs("form",{onSubmit:I,className:"mb-8 p-4 border rounded-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:l?"Matching Night bearbeiten":"Paare bilden"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:Array.from({length:b}).map((n,s)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-100 rounded-md",children:[e.jsxs("select",{value:i[s]?.mann||"",onChange:t=>v(s,"mann",t.target.value),className:"border p-2 rounded-md w-full",children:[e.jsx("option",{value:"",children:"Mann wählen"}),x.map(t=>e.jsx("option",{value:t.id,disabled:L.includes(String(t.id))&&i[s]?.mann!==String(t.id),children:t.name},t.id))]}),e.jsx("span",{children:"+"}),e.jsxs("select",{value:i[s]?.frau||"",onChange:t=>v(s,"frau",t.target.value),className:"border p-2 rounded-md w-full",children:[e.jsx("option",{value:"",children:"Frau wählen"}),f.map(t=>e.jsx("option",{value:t.id,disabled:z.includes(String(t.id))&&i[s]?.frau!==String(t.id),children:t.name},t.id))]})]},s))}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("label",{htmlFor:"lights",className:"font-bold",children:"Anzahl Lichter:"}),e.jsx("input",{type:"number",id:"lights",value:S,onChange:n=>c(parseInt(n.target.value,10)),min:"0",max:b,className:"border p-2 rounded-md w-24"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"submit",className:"bg-indigo-600 text-white px-4 py-2 rounded-md",children:l?"Änderungen speichern":"Matching Night speichern"}),l&&e.jsx("button",{type:"button",onClick:w,className:"bg-gray-500 text-white px-4 py-2 rounded-md",children:"Abbrechen"})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Bisherige Matching Nights"}),e.jsx("ul",{className:"space-y-4",children:a.matchingNights.map(n=>e.jsx("li",{className:"p-4 bg-gray-100 rounded-md",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold",children:["Lichter: ",n.lights]}),e.jsx("ul",{className:"mt-2",children:n.couples.map((s,t)=>{const r=x.find(j=>String(j.id)===String(s.mann)),F=f.find(j=>String(j.id)===String(s.frau));return e.jsxs("li",{children:[r?.name||"Unknown"," & ",F?.name||"Unknown"]},t)})})]}),u&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>A(n),className:"bg-yellow-500 text-white px-3 py-1 rounded-md",children:"Bearbeiten"}),e.jsx("button",{onClick:()=>y(a.id,n.id),className:"bg-red-500 text-white px-3 py-1 rounded-md",children:"Löschen"})]})]})},n.id))})]})]})}export{K as default};
