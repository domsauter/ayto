import{u as L,r as m,j as e}from"./auth-CiqFla1T.js";import{u as z}from"./season-B2oCyVg0.js";function I(){const{currentSeason:i,addMatchingNight:v,deleteMatchingNight:S,updateMatchingNight:M,loadingCurrentSeason:y,error:f}=z(),{profile:w}=L(),[a,d]=m.useState([]),[b,c]=m.useState(0),[r,u]=m.useState(null),g=w?.role==="admin";if(m.useEffect(()=>{u(null),d([]),c(0)},[i]),!i)return e.jsxs("div",{className:"p-8",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Matching Night"}),e.jsx("p",{children:"Bitte wähle zuerst eine Staffel aus."})]});if(y)return e.jsx("div",{className:"p-8",children:"Loading matching night data..."});if(f)return e.jsxs("div",{className:"p-8 text-red-500",children:["Error: ",f]});const h=i.candidates.filter(n=>n.gender==="Mann"),o=i.candidates.filter(n=>n.gender==="Frau");if(h.length===0||o.length===0)return e.jsxs("div",{className:"p-8",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Matching Night"}),e.jsx("p",{children:"Bitte füge zuerst Kandidaten hinzu (Männer und Frauen)."})]});const x=Math.min(h.length,o.length),j=(n,t,s)=>{const l=[...a];l[n]||(l[n]={}),l[n][t]=s,d(l)},C=n=>{u(n.id),d(n.couples),c(n.lights)},N=()=>{u(null),d([]),c(0)},E=n=>{if(n.preventDefault(),!g)return;if(a.length<x||a.some(s=>!s.mann||!s.frau)){alert("Please form all pairs.");return}const t={couples:a,lights:b};r?M(i.id,r,t):v(i.id,t),N()},k=a.map(n=>n.mann),P=a.map(n=>n.frau);return e.jsxs("div",{className:"p-8",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-4",children:["Matching Night für ",i.name]}),g&&e.jsxs("form",{onSubmit:E,className:"mb-8 p-4 border rounded-md",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:r?"Matching Night bearbeiten":"Paare bilden"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:Array.from({length:x}).map((n,t)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-100 rounded-md",children:[e.jsxs("select",{value:a[t]?.mann||"",onChange:s=>j(t,"mann",s.target.value),className:"border p-2 rounded-md w-full",children:[e.jsx("option",{value:"",children:"Mann wählen"}),h.map(s=>e.jsx("option",{value:s.id,disabled:k.includes(String(s.id))&&a[t]?.mann!==String(s.id),children:s.name},s.id))]}),e.jsx("span",{children:"+"}),e.jsxs("select",{value:a[t]?.frau||"",onChange:s=>j(t,"frau",s.target.value),className:"border p-2 rounded-md w-full",children:[e.jsx("option",{value:"",children:"Frau wählen"}),o.map(s=>e.jsx("option",{value:s.id,disabled:P.includes(String(s.id))&&a[t]?.frau!==String(s.id),children:s.name},s.id))]})]},t))}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("label",{htmlFor:"lights",className:"font-bold",children:"Anzahl Lichter:"}),e.jsx("input",{type:"number",id:"lights",value:b,onChange:n=>c(parseInt(n.target.value,10)),min:"0",max:x,className:"border p-2 rounded-md w-24"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"submit",className:"bg-indigo-600 text-white px-4 py-2 rounded-md",children:r?"Änderungen speichern":"Matching Night speichern"}),r&&e.jsx("button",{type:"button",onClick:N,className:"bg-gray-500 text-white px-4 py-2 rounded-md",children:"Abbrechen"})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Bisherige Matching Nights"}),e.jsx("ul",{className:"space-y-4",children:i.matchingNights.map(n=>e.jsx("li",{className:"p-4 bg-gray-100 rounded-md",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold",children:["Lichter: ",n.lights]}),e.jsx("ul",{className:"mt-2",children:n.couples.map((t,s)=>{const l=h.find(p=>String(p.id)===String(t.mann)),A=o.find(p=>String(p.id)===String(t.frau));return e.jsxs("li",{children:[l?.name||"Unknown"," & ",A?.name||"Unknown"]},s)})})]}),g&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>C(n),className:"bg-yellow-500 text-white px-3 py-1 rounded-md",children:"Bearbeiten"}),e.jsx("button",{onClick:()=>S(i.id,n.id),className:"bg-red-500 text-white px-3 py-1 rounded-md",children:"Löschen"})]})]})},n.id))})]})]})}export{I as default};
