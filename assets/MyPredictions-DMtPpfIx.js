import{u as y,r as o,j as s,s as g}from"./auth-CiqFla1T.js";import{u as _}from"./season-B2oCyVg0.js";import{s as C}from"./solver-CyFOJOAE.js";function A(){const{currentSeason:t,loadingCurrentSeason:b,error:l}=_(),{user:i}=y(),[a,d]=o.useState({}),[h,j]=o.useState(null),[v,c]=o.useState(!0),[u,m]=o.useState(null);if(o.useEffect(()=>{(async()=>{if(!i||!t){c(!1);return}c(!0),m(null);const{data:r,error:n}=await g.from("predictions").select("prediction_data").eq("user_id",i.id).eq("season_id",t.id).single();n&&n.code!=="PGRST116"?(console.error("Error fetching predictions:",n),m(n.message),d({})):d(r?r.prediction_data:{}),c(!1)})()},[i,t]),!t)return s.jsxs("div",{className:"p-8",children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Meine Predictions"}),s.jsx("p",{children:"Bitte wähle zuerst eine Staffel aus."})]});if(b||v)return s.jsx("div",{className:"p-8",children:"Loading your predictions..."});if(l||u)return s.jsxs("div",{className:"p-8 text-red-500",children:["Error: ",l||u]});const p=t.candidates.filter(e=>e.gender==="Mann"),f=t.candidates.filter(e=>e.gender==="Frau"),N=Math.min(p.length,f.length),P=(e,r)=>{d(n=>({...n,[e]:r}))},S=async()=>{if(!i){alert("You must be logged in to save predictions.");return}try{const{error:e}=await g.from("predictions").upsert({user_id:i.id,season_id:t.id,prediction_data:a},{onConflict:"user_id,season_id"});e?(console.error("Save error:",e),e.code==="42501"||e.code==="5"?alert("Fehler beim Speichern: Du hast keine Berechtigung. Bitte kontaktiere den Administrator."):alert("Error saving predictions: "+e.message)):alert("Predictions saved!")}catch(e){console.error("Exception during save:",e),alert("Unexpected error: "+e.message)}},E=()=>{const e=C(t);if(e.length===1){const r=e[0];let n=0;for(const x in a)parseInt(a[x])===r[x]&&n++;j(n)}else alert(`The solver has ${e.length} possible solutions. A final check is not yet possible.`)};return s.jsxs("div",{className:"p-8",children:[s.jsxs("h1",{className:"text-2xl font-bold mb-4",children:["Meine Predictions für ",t.name]}),s.jsxs("div",{className:"mb-8 p-4 border rounded-md",children:[s.jsx("h2",{className:"text-xl font-bold mb-2",children:"Meine Perfect Matches"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:p.map(e=>s.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-100 rounded-md",children:[s.jsx("span",{className:"font-bold w-1/3",children:e.name}),s.jsxs("select",{value:a[e.id]||"",onChange:r=>P(e.id,r.target.value),className:"border p-2 rounded-md w-2/3",children:[s.jsx("option",{value:"",children:"Frau wählen"}),f.map(r=>s.jsx("option",{value:r.id,children:r.name},r.id))]})]},e.id))}),s.jsx("button",{onClick:S,className:"bg-indigo-600 text-white px-4 py-2 rounded-md",children:"Predictions speichern"})]}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold mb-2",children:"Resume"}),s.jsx("button",{onClick:E,className:"bg-green-600 text-white px-4 py-2 rounded-md",children:"Predictions überprüfen"}),h!==null&&s.jsxs("div",{className:"mt-4",children:[s.jsx("h3",{className:"text-lg font-bold",children:"Dein Ergebnis:"}),s.jsxs("p",{children:["Du hast ",h," von ",N," Perfect Matches richtig vorhergesagt!"]})]})]})]})}export{A as default};
